
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Input Driven HMM &#8212; ssm  documentation</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-binder.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-dataframe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-rendered-html.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Input Driven Observations (“GLM-HMM”)" href="2b-Input-Driven-Observations-%28GLM-HMM%29.html" />
    <link rel="prev" title="Simple Linear Dynamical System Demo" href="1b-Simple-Linear-Dynamical-System.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
      
      
      <h1 class="site-logo" id="site-title">ssm  documentation</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="1-Simple-HMM-Demo.html">
   Hidden Markov Model Demo
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="1b-Simple-Linear-Dynamical-System.html">
   Simple Linear Dynamical System Demo
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Input Driven HMM
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="2b-Input-Driven-Observations-%28GLM-HMM%29.html">
   Input Driven Observations (“GLM-HMM”)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="3-Switching-Linear-Dynamical-System.html">
   Switching Linear Dynamical System Demo
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="4-Recurrent-SLDS.html">
   Recurrent SLDS
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="5-Poisson-SLDS.html">
   Poisson SLDS
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="6-Poisson-fLDS.html">
   Poisson fLDS
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="7-Variatonal-Laplace-EM-for-SLDS-Tutorial.html">
   Variational Laplace-EM
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="HMM-State-Clustering.html">
   HMM State Clustering
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Multi-Population-rSLDS.html">
   Multi-population recurrent switching linear dynamical systems overview
  </a>
 </li>
</ul>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../auto_examples/1-Simple-HMM-Demo.html">
   Simple HMM Demo
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../auto_examples/1b-Simple-Linear-Dynamical-System.html">
   Simple Linear Dynamical System Demo
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../auto_examples/2-Input-Driven-HMM.html">
   Input Driven HMM
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../auto_examples/2b-Input-Driven-Observations-%28GLM-HMM%29.html">
   Input Driven Observations (GLM-HMM)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../auto_examples/3-Switching-Linear-Dynamical-System.html">
   Switching Linear Dynamical System
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../auto_examples/4-Recurrent-SLDS.html">
   Recurrent SLDS
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../auto_examples/5-Poisson-SLDS.html">
   Poisson SLDS
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../auto_examples/6-Poisson-fLDS.html">
   Poisson fLDS
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../auto_examples/7-Variatonal-Laplace-EM-for-SLDS-Tutorial.html">
   Variational Laplace EM for SLDS
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../auto_examples/HMM-State-Clustering.html">
   HMM State Clustering
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../auto_examples/Multi-Population-rSLDS.html">
   Multi-Population rSLDS
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/lindermanlan/ssm-docs/main?urlpath=tree/notebooks/2-Input-Driven-HMM.md"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
      <li>
        <a href="https://colab.research.google.com/github/lindermanlan/ssm-docs/blob/main/notebooks/2-Input-Driven-HMM.md"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Colab"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../_static/images/logo_colab.png">
  </span>
<span class="headerbtn__text-container">Colab</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/notebooks/2-Input-Driven-HMM.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download notebook file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-code"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        <a href="../_sources/notebooks/2-Input-Driven-HMM.md.txt"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.md</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#setup">
   1. Setup
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#create-an-input-driven-hmm">
   2. Create an Input Driven HMM
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#exercise-em-for-the-input-driven-hmm">
     2.1 Exercise: EM for the input-driven HMM
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#fit-an-input-driven-hmm-to-data">
   3. Fit an input-driven HMM to data
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#permute-the-latent-states-check-convergence">
     3.1 Permute the latent states, check convergence
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#exercise-change-the-fitting-method">
     3.3 Exercise: Change the Fitting Method
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#visualize-the-learned-parameters">
   4. Visualize the Learned Parameters
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Input Driven HMM</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#setup">
   1. Setup
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#create-an-input-driven-hmm">
   2. Create an Input Driven HMM
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#exercise-em-for-the-input-driven-hmm">
     2.1 Exercise: EM for the input-driven HMM
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#fit-an-input-driven-hmm-to-data">
   3. Fit an input-driven HMM to data
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#permute-the-latent-states-check-convergence">
     3.1 Permute the latent states, check convergence
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#exercise-change-the-fitting-method">
     3.3 Exercise: Change the Fitting Method
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#visualize-the-learned-parameters">
   4. Visualize the Learned Parameters
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="input-driven-hmm">
<h1>Input Driven HMM<a class="headerlink" href="#input-driven-hmm" title="Permalink to this headline">#</a></h1>
<p>This notebook is a simple example of an HMM with exogenous inputs.  The inputs modulate the probability of discrete state transitions via a multiclass logistic regression. Let <span class="math notranslate nohighlight">\(z_t \in \{1, \ldots, K\}\)</span> denote the discrete latent state at time <span class="math notranslate nohighlight">\(t\)</span> and <span class="math notranslate nohighlight">\(u_t \in \mathbb{R}^U\)</span> be the exogenous input at time~<span class="math notranslate nohighlight">\(t\)</span>.  The transition probability is given by,</p>
<div class="math notranslate nohighlight">
\[
\begin{align}
\Pr(z_t = k \mid z_{t-1} = j, u_t) = 
\frac{\exp\{\log P_{j,k} + w_k^\mathsf{T} u_t\}}
{\sum_{k'=1}^K \exp\{\log P_{j,k'} + w_{k'}^\mathsf{T} u_t\}}.
\end{align}
\]</div>
<p>The parameters of the transition model are <span class="math notranslate nohighlight">\(P \in \mathbb{R}_+^{K \times K}\)</span>, a baseline set of (unnormalized) transition weights, and <span class="math notranslate nohighlight">\(W \in \mathbb{R}^{K \times U}\)</span>, a set of input weights.</p>
<section id="setup">
<h2>1. Setup<a class="headerlink" href="#setup" title="Permalink to this headline">#</a></h2>
<p>The line <code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">ssm</span></code> imports the package for use. Here, we have also imported a few other packages for plotting.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">numpy.random</span> <span class="k">as</span> <span class="nn">npr</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">ssm</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">from</span> <span class="nn">ssm.util</span> <span class="kn">import</span> <span class="n">one_hot</span><span class="p">,</span> <span class="n">find_permutation</span>

<span class="o">%</span><span class="k">matplotlib</span> inline

<span class="n">npr</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">palette</span><span class="o">=</span><span class="s2">&quot;colorblind&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/opt/miniconda3/envs/ssm-docs/lib/python3.9/site-packages/tqdm/auto.py:22: TqdmWarning: IProgress not found. Please update jupyter and ipywidgets. See https://ipywidgets.readthedocs.io/en/stable/user_install.html
  from .autonotebook import tqdm as notebook_tqdm
</pre></div>
</div>
</div>
</div>
</section>
<section id="create-an-input-driven-hmm">
<h2>2. Create an Input Driven HMM<a class="headerlink" href="#create-an-input-driven-hmm" title="Permalink to this headline">#</a></h2>
<p>SSM is designed to be modular, so that the user can easily mix and match different types of transitions and observations.<br />
We create an input-driven HMM with the following line:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">true_hmm</span> <span class="o">=</span> <span class="n">ssm</span><span class="o">.</span><span class="n">HMM</span><span class="p">(</span><span class="n">num_states</span><span class="p">,</span> <span class="n">obs_dim</span><span class="p">,</span> <span class="n">input_dim</span><span class="p">,</span> 
               <span class="n">observations</span><span class="o">=</span><span class="s2">&quot;categorical&quot;</span><span class="p">,</span> <span class="n">observation_kwargs</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">C</span><span class="o">=</span><span class="n">num_categories</span><span class="p">),</span>
               <span class="n">transitions</span><span class="o">=</span><span class="s2">&quot;inputdriven&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Let’s look at what each of the arguments do. The first three arguments specify the number of states, and the dimensionality of the observations and inputs.</p>
<p><strong>Setting the observation model</strong><br />
For this example, we have set <code class="docutils literal notranslate"><span class="pre">observations=&quot;categorical&quot;</span></code>, which means each observation will take on one of a discrete set of values, i.e <span class="math notranslate nohighlight">\(y_t \in \{1, \ldots, C \}\)</span>.
For categorical observations, the observations are drawn from a multinomial distribution, with parameters depending on the current state. Assuming <span class="math notranslate nohighlight">\(z_t = k\)</span>,the observations are a vector <span class="math notranslate nohighlight">\(y \in \mathbb{R}^D\)</span>, where <span class="math notranslate nohighlight">\(y_i \sim \text{mult} (\lambda_{k,i})\)</span>, where <span class="math notranslate nohighlight">\(\lambda_{k,i}\)</span> is the multinomal parameter associated with coordinate <span class="math notranslate nohighlight">\(i\)</span> of the observations in state <span class="math notranslate nohighlight">\(k\)</span>. Note that each observation variable is independent from the others.</p>
<p>For categorical observations, we also specify the number of discrete observations possible (in this case 3). We do this by creating a dictionary where the keys are the keyword arguments which we want to pass to the observation model. For categorical observations, there is just one keyword argument, <code class="docutils literal notranslate"><span class="pre">C</span></code>, which specifies the number of categories. This is set using <code class="docutils literal notranslate"><span class="pre">observation_kwargs=dict(C=num_categories)</span></code>.</p>
<p>The observations keyword argument should be one of : <code class="docutils literal notranslate"><span class="pre">&quot;gaussian&quot;,</span> <span class="pre">&quot;poisson&quot;</span> <span class="pre">&quot;studentst&quot;,</span> <span class="pre">&quot;exponential&quot;,</span> <span class="pre">&quot;bernoulli&quot;,</span> <span class="pre">&quot;autoregressive&quot;,</span> <span class="pre">&quot;robust_autoregressive&quot;</span></code>.
<strong>NOTE:</strong>
Setting the observations as “autoregressive” means that each observation will be dependent on the prior observation, as well as on the input (if the input is nonzero). By constrast, the standard “inputdriven” transitions are not affected by previous observations or directly by the inputs.</p>
<p><strong>Setting the transition model</strong><br />
In order to create an HMM with exogenous inputs, we set <code class="docutils literal notranslate"><span class="pre">transitions=&quot;inputdriven&quot;</span></code>. This means that the baseline transition matrix <span class="math notranslate nohighlight">\(P\)</span> is modified according to a Generalized Linear Model, as described at the top of the page.</p>
<p>SSM support many transition models, set by keyword argument to the constructor of the class. The keyword argument should be one of: <code class="docutils literal notranslate"><span class="pre">&quot;standard&quot;,</span> <span class="pre">&quot;sticky&quot;,</span> <span class="pre">&quot;inputdriven&quot;,</span> <span class="pre">&quot;recurrent&quot;,</span> <span class="pre">&quot;recurrent_only&quot;,</span> <span class="pre">&quot;rbf_recurrent&quot;,</span> <span class="pre">&quot;nn_recurrent&quot;.</span></code> We’re working on creating standalone documentation to describe these in more detail. For most users, the stationary and input driven transition classes should suffice.</p>
<p><strong>Creating inputs and sampling</strong><br />
After creating our HMM object, we create an input array called <code class="docutils literal notranslate"><span class="pre">inpt</span></code> which is simply a jittered sine wave. We also increase the transition weights so that it will be clear (for demonstration purposes) that the input is changing the transition probabilities. In this case, we will actually increase the weights such that the transitions appear almost deterministic.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set the parameters of the HMM</span>
<span class="n">time_bins</span> <span class="o">=</span> <span class="mi">1000</span> <span class="c1"># number of time bins</span>
<span class="n">num_states</span> <span class="o">=</span> <span class="mi">2</span>    <span class="c1"># number of discrete states</span>
<span class="n">obs_dim</span> <span class="o">=</span> <span class="mi">1</span>    <span class="c1"># data dimension</span>
<span class="n">input_dim</span> <span class="o">=</span> <span class="mi">1</span>    <span class="c1"># input dimension</span>
<span class="n">num_categories</span> <span class="o">=</span> <span class="mi">3</span>    <span class="c1"># number of output types/categories</span>

<span class="c1"># Make an HMM</span>
<span class="n">true_hmm</span> <span class="o">=</span> <span class="n">ssm</span><span class="o">.</span><span class="n">HMM</span><span class="p">(</span><span class="n">num_states</span><span class="p">,</span> <span class="n">obs_dim</span><span class="p">,</span> <span class="n">input_dim</span><span class="p">,</span> 
               <span class="n">observations</span><span class="o">=</span><span class="s2">&quot;categorical&quot;</span><span class="p">,</span> <span class="n">observation_kwargs</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">C</span><span class="o">=</span><span class="n">num_categories</span><span class="p">),</span>
               <span class="n">transitions</span><span class="o">=</span><span class="s2">&quot;inputdriven&quot;</span><span class="p">)</span>

<span class="c1"># Optionally, turn up the input weights to exaggerate the effect</span>
<span class="n">true_hmm</span><span class="o">.</span><span class="n">transitions</span><span class="o">.</span><span class="n">Ws</span> <span class="o">*=</span> <span class="mi">3</span>

<span class="c1"># Create an exogenous input</span>
<span class="n">inpt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">time_bins</span><span class="p">)</span> <span class="o">/</span> <span class="mi">50</span><span class="p">)[:,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1e-1</span> <span class="o">*</span> <span class="n">npr</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">time_bins</span><span class="p">,</span> <span class="n">input_dim</span><span class="p">)</span>

<span class="c1"># Sample some data from the HMM</span>
<span class="n">true_states</span><span class="p">,</span> <span class="n">obs</span> <span class="o">=</span> <span class="n">true_hmm</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">time_bins</span><span class="p">,</span> <span class="nb">input</span><span class="o">=</span><span class="n">inpt</span><span class="p">)</span>

<span class="c1"># Compute the true log probability of the data, summing out the discrete states</span>
<span class="n">true_lp</span> <span class="o">=</span> <span class="n">true_hmm</span><span class="o">.</span><span class="n">log_probability</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">inpt</span><span class="p">)</span>

<span class="c1"># By default, SSM returns categorical observations as a list of lists.</span>
<span class="c1"># We convert to a 1D array for plotting.</span>
<span class="n">obs_flat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">obs</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot the data</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">311</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">inpt</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">([])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">time_bins</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;input&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">312</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">true_states</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="p">:],</span> <span class="n">aspect</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">([])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">time_bins</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;discrete</span><span class="se">\n</span><span class="s2">state&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">([])</span>

<span class="c1"># Create Cmap for visualizing categorical observations</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">313</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">obs_flat</span><span class="p">[</span><span class="kc">None</span><span class="p">,:],</span> <span class="n">aspect</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span> <span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">time_bins</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;observation&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">b</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/var/folders/_h/5_yjn8t51cs21zb_j5p6sqc00000gq/T/ipykernel_1010/4108096739.py:22: MatplotlibDeprecationWarning: The &#39;b&#39; parameter of grid() has been renamed &#39;visible&#39; since Matplotlib 3.5; support for the old name will be dropped two minor releases later.
  plt.grid(b=None)
</pre></div>
</div>
<img alt="../_images/02f690aa4e5fca810266b440e4e161edbf2f025fdc5dc0934ee676ed83c3b80f.png" src="../_images/02f690aa4e5fca810266b440e4e161edbf2f025fdc5dc0934ee676ed83c3b80f.png" />
</div>
</div>
<section id="exercise-em-for-the-input-driven-hmm">
<h3>2.1 Exercise: EM for the input-driven HMM<a class="headerlink" href="#exercise-em-for-the-input-driven-hmm" title="Permalink to this headline">#</a></h3>
<p>There are a few good references that derive the EM algorithm for the case of a vanilla HMM (e.g Machine Learning and Pattern Recognition, by Chris Bishop, and <a class="reference external" href="https://www.ece.ucsb.edu/Faculty/Rabiner/ece259/Reprints/tutorial%20on%20hmm%20and%20applications.pdf">this tutorial</a> by Lawrence Rabiner. How should the EM updates change for the case of input-driven HMMs?</p>
</section>
</section>
<section id="fit-an-input-driven-hmm-to-data">
<h2>3. Fit an input-driven HMM to data<a class="headerlink" href="#fit-an-input-driven-hmm-to-data" title="Permalink to this headline">#</a></h2>
<p>Below, we’ll show to fit an input-driven HMM from data. We’ll treat the samples generated above as a dataset, and try to learn the appropriate HMM parameters from this dataset.</p>
<p>We create a new HMM object here, with the same parameters as the HMM in Section 1:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">hmm</span> <span class="o">=</span> <span class="n">ssm</span><span class="o">.</span><span class="n">HMM</span><span class="p">(</span><span class="n">num_states</span><span class="p">,</span> <span class="n">obs_dim</span><span class="p">,</span> <span class="n">input_dim</span><span class="p">,</span> 
          <span class="n">observations</span><span class="o">=</span><span class="s2">&quot;categorical&quot;</span><span class="p">,</span> <span class="n">observation_kwargs</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">C</span><span class="o">=</span><span class="n">num_categories</span><span class="p">),</span>
          <span class="n">transitions</span><span class="o">=</span><span class="s2">&quot;inputdriven&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>We fit the dataset simply by calling the <code class="docutils literal notranslate"><span class="pre">fit</span></code> method:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">hmm_lps</span> <span class="o">=</span> <span class="n">hmm</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">inpt</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;em&quot;</span><span class="p">,</span> <span class="n">num_em_iters</span><span class="o">=</span><span class="n">N_iters</span><span class="p">)</span>
</pre></div>
</div>
<p>Here, the variable <code class="docutils literal notranslate"><span class="pre">hmm_lps</span></code> will be set to a list of log-probabilities at each step of the EM-algorithm, which we’ll use to check convergence.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Now create a new HMM and fit it to the data with EM</span>
<span class="n">N_iters</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">hmm</span> <span class="o">=</span> <span class="n">ssm</span><span class="o">.</span><span class="n">HMM</span><span class="p">(</span><span class="n">num_states</span><span class="p">,</span> <span class="n">obs_dim</span><span class="p">,</span> <span class="n">input_dim</span><span class="p">,</span> 
          <span class="n">observations</span><span class="o">=</span><span class="s2">&quot;categorical&quot;</span><span class="p">,</span> <span class="n">observation_kwargs</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">C</span><span class="o">=</span><span class="n">num_categories</span><span class="p">),</span>
          <span class="n">transitions</span><span class="o">=</span><span class="s2">&quot;inputdriven&quot;</span><span class="p">)</span>

<span class="c1"># Fit</span>
<span class="n">hmm_lps</span> <span class="o">=</span> <span class="n">hmm</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">inpt</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;em&quot;</span><span class="p">,</span> <span class="n">num_iters</span><span class="o">=</span><span class="n">N_iters</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  0%|                                                                                                             | 0/100 [00:00&lt;?, ?it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LP: -1028.4:   0%|                                                                                                | 0/100 [00:00&lt;?, ?it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LP: -1028.4:   0%|                                                                                                | 0/100 [00:00&lt;?, ?it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LP: -1028.1:   0%|                                                                                                | 0/100 [00:00&lt;?, ?it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LP: -1027.6:   0%|                                                                                                | 0/100 [00:00&lt;?, ?it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LP: -1026.2:   0%|                                                                                                | 0/100 [00:00&lt;?, ?it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LP: -1021.0:   0%|                                                                                                | 0/100 [00:00&lt;?, ?it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LP: -1004.7:   0%|                                                                                                | 0/100 [00:00&lt;?, ?it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LP: -984.2:   0%|                                                                                                 | 0/100 [00:00&lt;?, ?it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LP: -972.3:   0%|                                                                                                 | 0/100 [00:00&lt;?, ?it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LP: -964.0:   0%|                                                                                                 | 0/100 [00:00&lt;?, ?it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LP: -958.1:   0%|                                                                                                 | 0/100 [00:00&lt;?, ?it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LP: -958.1:  10%|████████▊                                                                               | 10/100 [00:00&lt;00:00, 97.76it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LP: -954.8:  10%|████████▊                                                                               | 10/100 [00:00&lt;00:00, 97.76it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LP: -953.0:  10%|████████▊                                                                               | 10/100 [00:00&lt;00:00, 97.76it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LP: -952.2:  10%|████████▊                                                                               | 10/100 [00:00&lt;00:00, 97.76it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LP: -951.6:  10%|████████▊                                                                               | 10/100 [00:00&lt;00:00, 97.76it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LP: -951.2:  10%|████████▊                                                                               | 10/100 [00:00&lt;00:00, 97.76it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LP: -950.8:  10%|████████▊                                                                               | 10/100 [00:00&lt;00:00, 97.76it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LP: -950.4:  10%|████████▊                                                                               | 10/100 [00:00&lt;00:00, 97.76it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LP: -950.1:  10%|████████▊                                                                               | 10/100 [00:00&lt;00:00, 97.76it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LP: -949.9:  10%|████████▊                                                                               | 10/100 [00:00&lt;00:00, 97.76it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LP: -949.6:  10%|████████▊                                                                               | 10/100 [00:00&lt;00:00, 97.76it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LP: -949.5:  10%|████████▊                                                                               | 10/100 [00:00&lt;00:00, 97.76it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LP: -949.5:  21%|██████████████████▎                                                                    | 21/100 [00:00&lt;00:00, 102.32it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LP: -949.3:  21%|██████████████████▎                                                                    | 21/100 [00:00&lt;00:00, 102.32it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LP: -949.2:  21%|██████████████████▎                                                                    | 21/100 [00:00&lt;00:00, 102.32it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LP: -949.1:  21%|██████████████████▎                                                                    | 21/100 [00:00&lt;00:00, 102.32it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LP: -949.1:  21%|██████████████████▎                                                                    | 21/100 [00:00&lt;00:00, 102.32it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LP: -949.0:  21%|██████████████████▎                                                                    | 21/100 [00:00&lt;00:00, 102.32it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LP: -949.0:  21%|██████████████████▎                                                                    | 21/100 [00:00&lt;00:00, 102.32it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LP: -948.9:  21%|██████████████████▎                                                                    | 21/100 [00:00&lt;00:00, 102.32it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LP: -948.9:  21%|██████████████████▎                                                                    | 21/100 [00:00&lt;00:00, 102.32it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LP: -948.9:  21%|██████████████████▎                                                                    | 21/100 [00:00&lt;00:00, 102.32it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LP: -948.8:  21%|██████████████████▎                                                                    | 21/100 [00:00&lt;00:00, 102.32it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LP: -948.8:  21%|██████████████████▎                                                                    | 21/100 [00:00&lt;00:00, 102.32it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LP: -948.8:  21%|██████████████████▎                                                                    | 21/100 [00:00&lt;00:00, 102.32it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LP: -948.8:  21%|██████████████████▎                                                                    | 21/100 [00:00&lt;00:00, 102.32it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LP: -948.8:  21%|██████████████████▎                                                                    | 21/100 [00:00&lt;00:00, 102.32it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LP: -948.8:  35%|██████████████████████████████▍                                                        | 35/100 [00:00&lt;00:00, 117.40it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LP: -948.8:  35%|██████████████████████████████▍                                                        | 35/100 [00:00&lt;00:00, 117.40it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LP: -948.7:  35%|██████████████████████████████▍                                                        | 35/100 [00:00&lt;00:00, 117.40it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LP: -948.7:  35%|██████████████████████████████▍                                                        | 35/100 [00:00&lt;00:00, 117.40it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LP: -948.7:  35%|██████████████████████████████▍                                                        | 35/100 [00:00&lt;00:00, 117.40it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LP: -948.7:  35%|██████████████████████████████▍                                                        | 35/100 [00:00&lt;00:00, 117.40it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LP: -948.7:  35%|██████████████████████████████▍                                                        | 35/100 [00:00&lt;00:00, 117.40it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LP: -948.7:  35%|██████████████████████████████▍                                                        | 35/100 [00:00&lt;00:00, 117.40it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LP: -948.7:  35%|██████████████████████████████▍                                                        | 35/100 [00:00&lt;00:00, 117.40it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LP: -948.7:  35%|██████████████████████████████▍                                                        | 35/100 [00:00&lt;00:00, 117.40it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LP: -948.7:  35%|██████████████████████████████▍                                                        | 35/100 [00:00&lt;00:00, 117.40it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LP: -948.7:  35%|██████████████████████████████▍                                                        | 35/100 [00:00&lt;00:00, 117.40it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LP: -948.7:  35%|██████████████████████████████▍                                                        | 35/100 [00:00&lt;00:00, 117.40it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LP: -948.7:  35%|██████████████████████████████▍                                                        | 35/100 [00:00&lt;00:00, 117.40it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LP: -948.7:  35%|██████████████████████████████▍                                                        | 35/100 [00:00&lt;00:00, 117.40it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LP: -948.7:  35%|██████████████████████████████▍                                                        | 35/100 [00:00&lt;00:00, 117.40it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LP: -948.7:  35%|██████████████████████████████▍                                                        | 35/100 [00:00&lt;00:00, 117.40it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LP: -948.7:  35%|██████████████████████████████▍                                                        | 35/100 [00:00&lt;00:00, 117.40it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LP: -948.7:  35%|██████████████████████████████▍                                                        | 35/100 [00:00&lt;00:00, 117.40it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LP: -948.7:  35%|██████████████████████████████▍                                                        | 35/100 [00:00&lt;00:00, 117.40it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LP: -948.7:  35%|██████████████████████████████▍                                                        | 35/100 [00:00&lt;00:00, 117.40it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LP: -948.7:  35%|██████████████████████████████▍                                                        | 35/100 [00:00&lt;00:00, 117.40it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LP: -948.7:  35%|██████████████████████████████▍                                                        | 35/100 [00:00&lt;00:00, 117.40it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LP: -948.7:  35%|██████████████████████████████▍                                                        | 35/100 [00:00&lt;00:00, 117.40it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LP: -948.7:  35%|██████████████████████████████▍                                                        | 35/100 [00:00&lt;00:00, 117.40it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LP: -948.7:  59%|███████████████████████████████████████████████████▎                                   | 59/100 [00:00&lt;00:00, 164.41it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LP: -948.7:  59%|███████████████████████████████████████████████████▎                                   | 59/100 [00:00&lt;00:00, 164.41it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LP: -948.7:  59%|███████████████████████████████████████████████████▎                                   | 59/100 [00:00&lt;00:00, 164.41it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LP: -948.7:  59%|███████████████████████████████████████████████████▎                                   | 59/100 [00:00&lt;00:00, 164.41it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LP: -948.7:  59%|███████████████████████████████████████████████████▎                                   | 59/100 [00:00&lt;00:00, 164.41it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LP: -948.7:  59%|███████████████████████████████████████████████████▎                                   | 59/100 [00:00&lt;00:00, 164.41it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LP: -948.7:  59%|███████████████████████████████████████████████████▎                                   | 59/100 [00:00&lt;00:00, 164.41it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LP: -948.7:  59%|███████████████████████████████████████████████████▎                                   | 59/100 [00:00&lt;00:00, 164.41it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LP: -948.7:  59%|███████████████████████████████████████████████████▎                                   | 59/100 [00:00&lt;00:00, 164.41it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LP: -948.7:  59%|███████████████████████████████████████████████████▎                                   | 59/100 [00:00&lt;00:00, 164.41it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LP: -948.7:  59%|███████████████████████████████████████████████████▎                                   | 59/100 [00:00&lt;00:00, 164.41it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LP: -948.7:  59%|███████████████████████████████████████████████████▎                                   | 59/100 [00:00&lt;00:00, 164.41it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LP: -948.7:  59%|███████████████████████████████████████████████████▎                                   | 59/100 [00:00&lt;00:00, 164.41it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LP: -948.7:  59%|███████████████████████████████████████████████████▎                                   | 59/100 [00:00&lt;00:00, 164.41it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LP: -948.7:  59%|███████████████████████████████████████████████████▎                                   | 59/100 [00:00&lt;00:00, 164.41it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LP: -948.7:  59%|███████████████████████████████████████████████████▎                                   | 59/100 [00:00&lt;00:00, 164.41it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LP: -948.7:  59%|███████████████████████████████████████████████████▎                                   | 59/100 [00:00&lt;00:00, 164.41it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LP: -948.7:  59%|███████████████████████████████████████████████████▎                                   | 59/100 [00:00&lt;00:00, 164.41it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LP: -948.7:  59%|███████████████████████████████████████████████████▎                                   | 59/100 [00:00&lt;00:00, 164.41it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LP: -948.7:  59%|███████████████████████████████████████████████████▎                                   | 59/100 [00:00&lt;00:00, 164.41it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LP: -948.7:  59%|███████████████████████████████████████████████████▎                                   | 59/100 [00:00&lt;00:00, 164.41it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LP: -948.7:  59%|███████████████████████████████████████████████████▎                                   | 59/100 [00:00&lt;00:00, 164.41it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LP: -948.7:  59%|███████████████████████████████████████████████████▎                                   | 59/100 [00:00&lt;00:00, 164.41it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LP: -948.7:  59%|███████████████████████████████████████████████████▎                                   | 59/100 [00:00&lt;00:00, 164.41it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LP: -948.7:  59%|███████████████████████████████████████████████████▎                                   | 59/100 [00:00&lt;00:00, 164.41it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LP: -948.7:  59%|███████████████████████████████████████████████████▎                                   | 59/100 [00:00&lt;00:00, 164.41it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LP: -948.7:  59%|███████████████████████████████████████████████████▎                                   | 59/100 [00:00&lt;00:00, 164.41it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LP: -948.7:  59%|███████████████████████████████████████████████████▎                                   | 59/100 [00:00&lt;00:00, 164.41it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LP: -948.7:  59%|███████████████████████████████████████████████████▎                                   | 59/100 [00:00&lt;00:00, 164.41it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LP: -948.7:  59%|███████████████████████████████████████████████████▎                                   | 59/100 [00:00&lt;00:00, 164.41it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LP: -948.7:  88%|████████████████████████████████████████████████████████████████████████████▌          | 88/100 [00:00&lt;00:00, 207.12it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LP: -948.7:  88%|████████████████████████████████████████████████████████████████████████████▌          | 88/100 [00:00&lt;00:00, 207.12it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LP: -948.7:  88%|████████████████████████████████████████████████████████████████████████████▌          | 88/100 [00:00&lt;00:00, 207.12it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LP: -948.7:  88%|████████████████████████████████████████████████████████████████████████████▌          | 88/100 [00:00&lt;00:00, 207.12it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LP: -948.7:  88%|████████████████████████████████████████████████████████████████████████████▌          | 88/100 [00:00&lt;00:00, 207.12it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LP: -948.7:  88%|████████████████████████████████████████████████████████████████████████████▌          | 88/100 [00:00&lt;00:00, 207.12it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LP: -948.7:  88%|████████████████████████████████████████████████████████████████████████████▌          | 88/100 [00:00&lt;00:00, 207.12it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LP: -948.7:  88%|████████████████████████████████████████████████████████████████████████████▌          | 88/100 [00:00&lt;00:00, 207.12it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LP: -948.7:  88%|████████████████████████████████████████████████████████████████████████████▌          | 88/100 [00:00&lt;00:00, 207.12it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LP: -948.7:  88%|████████████████████████████████████████████████████████████████████████████▌          | 88/100 [00:00&lt;00:00, 207.12it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LP: -948.7:  88%|████████████████████████████████████████████████████████████████████████████▌          | 88/100 [00:00&lt;00:00, 207.12it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LP: -948.7:  88%|████████████████████████████████████████████████████████████████████████████▌          | 88/100 [00:00&lt;00:00, 207.12it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LP: -948.7:  88%|████████████████████████████████████████████████████████████████████████████▌          | 88/100 [00:00&lt;00:00, 207.12it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LP: -948.7: 100%|██████████████████████████████████████████████████████████████████████████████████████| 100/100 [00:00&lt;00:00, 179.81it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</div>
<section id="permute-the-latent-states-check-convergence">
<h3>3.1 Permute the latent states, check convergence<a class="headerlink" href="#permute-the-latent-states-check-convergence" title="Permalink to this headline">#</a></h3>
<p>As in the vanilla-HMM notebook, we need to find a permutation of the latent states from our new hmm such that they match the states from the true HMM above. SSM accomplishes this with two function calls: first, we call <code class="docutils literal notranslate"><span class="pre">find_permutation(true_states,</span> <span class="pre">inferred_states)</span></code> which returns a list of indexes into states.</p>
<p>Then, we call <code class="docutils literal notranslate"><span class="pre">hmm.permute(permuation)</span></code> with the results of our first function call. Finally, we set <code class="docutils literal notranslate"><span class="pre">inferred_states</span></code> to be the underlying states we predict given the data.</p>
<p>Below, we plot the results of the <code class="docutils literal notranslate"><span class="pre">fit</span></code> function in order to check convergence of the EM algorithm. We see that the log-probability from the EM algorithm approaches the true log-probability of the data (which we have stored as <code class="docutils literal notranslate"><span class="pre">lp_true</span></code>).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Find a permutation of the states that best matches the true and inferred states</span>
<span class="n">hmm</span><span class="o">.</span><span class="n">permute</span><span class="p">(</span><span class="n">find_permutation</span><span class="p">(</span><span class="n">true_states</span><span class="p">,</span> <span class="n">hmm</span><span class="o">.</span><span class="n">most_likely_states</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span> <span class="nb">input</span><span class="o">=</span><span class="n">inpt</span><span class="p">)))</span>
<span class="n">inferred_states</span> <span class="o">=</span> <span class="n">hmm</span><span class="o">.</span><span class="n">most_likely_states</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span> <span class="nb">input</span><span class="o">=</span><span class="n">inpt</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot the log probabilities of the true and fit models</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">hmm_lps</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;EM&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">N_iters</span><span class="p">],</span> <span class="n">true_lp</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="s1">&#39;:k&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;True&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;lower right&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;EM Iteration&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">N_iters</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Log Probability&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/96083a7fac1bbe524846b3082f1e16c65140960b4bdbf835ef155d0d82744b79.png" src="../_images/96083a7fac1bbe524846b3082f1e16c65140960b4bdbf835ef155d0d82744b79.png" />
</div>
</div>
</section>
<section id="exercise-change-the-fitting-method">
<h3>3.3 Exercise: Change the Fitting Method<a class="headerlink" href="#exercise-change-the-fitting-method" title="Permalink to this headline">#</a></h3>
<p>As an experiment, try fitting the same dataset using another fitting method. The two other fitting methods supported for HMMs are “sgd” and “adam”, which you can set by passing <code class="docutils literal notranslate"><span class="pre">method=&quot;sgd&quot;</span></code> and <code class="docutils literal notranslate"><span class="pre">method=&quot;adam&quot;</span></code> respectively. For these methods, you’ll probably need to increase the number of iteratations to around 1000 or so.</p>
<p>After fitting with a different method, re-run the two cells above to generate a plot. How does the convergence of these other methods converge to EM?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot the true and inferred states</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">211</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">true_states</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="p">:],</span> <span class="n">aspect</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">([])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">time_bins</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;true</span><span class="se">\n</span><span class="s2">state&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">([])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">212</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">inferred_states</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="p">:],</span> <span class="n">aspect</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">time_bins</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;inferred</span><span class="se">\n</span><span class="s2">state&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">([])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/cd188d84f125c585783e431aeba14d4dcf9f1a67075ba9e0bc0d6651ae0e42ee.png" src="../_images/cd188d84f125c585783e431aeba14d4dcf9f1a67075ba9e0bc0d6651ae0e42ee.png" />
</div>
</div>
</section>
</section>
<section id="visualize-the-learned-parameters">
<h2>4. Visualize the Learned Parameters<a class="headerlink" href="#visualize-the-learned-parameters" title="Permalink to this headline">#</a></h2>
<p>After calling <code class="docutils literal notranslate"><span class="pre">fit</span></code>, our new HMM object will have parameters updated according to the dataset. We can get a sense of whether we successfully learned these parameters by comparing them to the <em>true</em> parameters which generated the data.</p>
<p>Below, we plot the baseline log transition probabilities (the log of the state-transition matrix) as well as the input weights <span class="math notranslate nohighlight">\(w\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot the true and inferred input effects</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

<span class="n">vlim</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">true_hmm</span><span class="o">.</span><span class="n">transitions</span><span class="o">.</span><span class="n">log_Ps</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
           <span class="nb">abs</span><span class="p">(</span><span class="n">true_hmm</span><span class="o">.</span><span class="n">transitions</span><span class="o">.</span><span class="n">Ws</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
           <span class="nb">abs</span><span class="p">(</span><span class="n">hmm</span><span class="o">.</span><span class="n">transitions</span><span class="o">.</span><span class="n">log_Ps</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
           <span class="nb">abs</span><span class="p">(</span><span class="n">hmm</span><span class="o">.</span><span class="n">transitions</span><span class="o">.</span><span class="n">Ws</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">141</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">true_hmm</span><span class="o">.</span><span class="n">transitions</span><span class="o">.</span><span class="n">log_Ps</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=-</span><span class="n">vlim</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vlim</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;RdBu&quot;</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">num_states</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">num_states</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;True</span><span class="se">\n</span><span class="s2">Baseline Weights&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">b</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>


<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">142</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">true_hmm</span><span class="o">.</span><span class="n">transitions</span><span class="o">.</span><span class="n">Ws</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=-</span><span class="n">vlim</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vlim</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;RdBu&quot;</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="n">num_states</span><span class="o">/</span><span class="n">input_dim</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">input_dim</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">num_states</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;True</span><span class="se">\n</span><span class="s2">Input Weights&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">b</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>


<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">143</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">hmm</span><span class="o">.</span><span class="n">transitions</span><span class="o">.</span><span class="n">log_Ps</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=-</span><span class="n">vlim</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vlim</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;RdBu&quot;</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">num_states</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">num_states</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Inferred</span><span class="se">\n</span><span class="s2">Baseline Weights&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">b</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>


<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">144</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">hmm</span><span class="o">.</span><span class="n">transitions</span><span class="o">.</span><span class="n">Ws</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=-</span><span class="n">vlim</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vlim</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;RdBu&quot;</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="n">num_states</span><span class="o">/</span><span class="n">input_dim</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">input_dim</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">num_states</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Inferred</span><span class="se">\n</span><span class="s2">Input Weights&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">b</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/var/folders/_h/5_yjn8t51cs21zb_j5p6sqc00000gq/T/ipykernel_1010/3158714203.py:14: MatplotlibDeprecationWarning: The &#39;b&#39; parameter of grid() has been renamed &#39;visible&#39; since Matplotlib 3.5; support for the old name will be dropped two minor releases later.
  plt.grid(b=None)
/var/folders/_h/5_yjn8t51cs21zb_j5p6sqc00000gq/T/ipykernel_1010/3158714203.py:22: MatplotlibDeprecationWarning: The &#39;b&#39; parameter of grid() has been renamed &#39;visible&#39; since Matplotlib 3.5; support for the old name will be dropped two minor releases later.
  plt.grid(b=None)
/var/folders/_h/5_yjn8t51cs21zb_j5p6sqc00000gq/T/ipykernel_1010/3158714203.py:30: MatplotlibDeprecationWarning: The &#39;b&#39; parameter of grid() has been renamed &#39;visible&#39; since Matplotlib 3.5; support for the old name will be dropped two minor releases later.
  plt.grid(b=None)
/var/folders/_h/5_yjn8t51cs21zb_j5p6sqc00000gq/T/ipykernel_1010/3158714203.py:38: MatplotlibDeprecationWarning: The &#39;b&#39; parameter of grid() has been renamed &#39;visible&#39; since Matplotlib 3.5; support for the old name will be dropped two minor releases later.
  plt.grid(b=None)
</pre></div>
</div>
<img alt="../_images/f7667fc763883faeb3ccda8845a396ec72e676b6720ed14abb2042931f6546a3.png" src="../_images/f7667fc763883faeb3ccda8845a396ec72e676b6720ed14abb2042931f6546a3.png" />
</div>
</div>
</section>
</section>


              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="1b-Simple-Linear-Dynamical-System.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Simple Linear Dynamical System Demo</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="2b-Input-Driven-Observations-%28GLM-HMM%29.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Input Driven Observations (“GLM-HMM”)</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Scott Linderman<br/>
  
      &copy; Copyright 2022, Scott Linderman.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>